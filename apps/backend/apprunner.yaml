version: 1.0
runtime: nodejs20
build:
  commands:
    # The build steps are handled in the Dockerfile
    # The Docker image already contains the compiled application
    # This is why we don't need build steps here in App Runner
    pre-build: []
    build: []
    post-build: []

run:
  runtime-version: 20.10.0
  command: node dist/main.js
  network:
    port: 4000
    env: PORT
  env:
    # Default environment variables - override these in the App Runner console for sensitive values
    - name: NODE_ENV
      value: production

# Health check configuration
health-check:
  path: /health
  protocol: HTTP
  interval: 10
  timeout: 5
  healthy-threshold: 3
  unhealthy-threshold: 5

# Instance configuration (matching GitHub workflow)
instance:
  cpu: 2 vCPU
  memory: 4 GB
  instance-roles:
    - name: AppRunnerECRAccessRole
      # Add specific ARN if you created a custom role
